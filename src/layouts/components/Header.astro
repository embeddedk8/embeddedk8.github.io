---
import HeaderLink from './HeaderLink.astro';
import { Image } from 'astro:assets';
import SocialIcons from '../../components/widgets/SocialIcons.astro';
import AvaLogo from '@src/assets/img/small-ava.jpg';

const menu = [
  { link: '/about/', label: 'About' },
  { link: '/posts/', label: 'Posts' },
  { link: '/projects/', label: 'Projects' },
  { link: '/tags/', label: 'Tags' },
];
---

<header id="site-header" class="w-full py-3">
  <div class="container flex items-center justify-between gap-6">

    <!-- Left: avatar -->
    <a href="/" class="flex items-center">
      <Image src={AvaLogo} alt="Avatar" class="rounded-full w-10 h-10 border-white border-2 shadow-lg"/>
    </a>

    <!-- Middle: nav menu -->
    <nav class="flex items-center gap-4 text-sm">
      <HeaderLink href="/" class="py-1">Home</HeaderLink>
      {
        menu.map((item) => (
          <HeaderLink href={item.link} class="py-1">
            {item.label}
          </HeaderLink>
        ))
      }
    </nav>

    <!-- Right: socials + theme -->
    <div class="flex items-center gap-2">
      <SocialIcons />
      <button class="p-2" id="themeToggle" aria-label="Theme mode">
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
        <svg class="moon hidden" xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
      </button>
    </div>
  </div>

  <style is:global>
    .dark #themeToggle .sun { display: none; }
    .dark #themeToggle .moon { display: block; }
  </style>

  <script is:inline>
    const theme = (() => {
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark';
      if (localStorage.getItem('theme')) return localStorage.getItem('theme');
      return 'light';
    })();
    document.documentElement.classList.toggle('dark', theme === 'dark');
    localStorage.setItem('theme', theme);
    document.getElementById('themeToggle')?.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
  </script>

</header>
